<!-- templates/admin.html -->
{% extends "base.html" %}
{% block content %}
  <h2>Admin Panel</h2>

  <!-- Верхняя панель с именем пользователя и кнопкой Logout -->
  <div class="header">
    <p>Logged in as: <strong>{{ session.get('username') }}</strong></p>
    <a href="{{ url_for('logout') }}" class="logout-button">Logout</a>
  </div>

  <h3>Messages</h3>
  {% for message in messages %}
    <div class="message">
      <strong>{{ message.user.username }}:</strong> 
      
      {% if message.id == (request.args.get('edit_id') | int) %}
        <!-- Форма редактирования сообщения -->
        <form method="POST" action="{{ url_for('admin') }}">
          <input type="hidden" name="message_id" value="{{ message.id }}">
          <textarea name="new_content">{{ message.content }}</textarea>
          <button type="submit" name="action" value="save_edit">Save</button>
          <a href="{{ url_for('admin') }}">Cancel</a>
        </form>
      {% else %}
        {{ message.content }} 
        <br><small>{{ message.timestamp.strftime('%Y-%m-%d %H:%M:%S') }} - 
        <em>{{ 'Visible' if message.visible else 'Hidden' }}</em></small>
        <form method="POST" style="display: inline;">
          <input type="hidden" name="message_id" value="{{ message.id }}">
          <button type="submit" name="action" value="toggle_visibility">
            {{ 'Hide' if message.visible else 'Show' }}
          </button>
          <a href="{{ url_for('admin', edit_id=message.id) }}">Edit</a>
          <button type="submit" name="action" value="delete">Delete</button>
        </form>
      {% endif %}
    </div>
  {% endfor %}

  <a href="{{ url_for('chat') }}">Back to Chat</a>
{% endblock %}
